# **Active Recordのマイグレーション**

## **1. マイグレーションの概要**
マイグレーションは、データベーススキーマを管理し、継続的に進化させる便利な方法です。Active Recordの**マイグレーションはRubyのDSL** を利用しているため、SQLを直接記述せずにデータベースのスキーマを操作できます。

個々のマイグレーションは、データベースの新しい「バージョン」として扱われ、時系列に沿って適用・ロールバックが可能です。Active Recordは適用するマイグレーションを認識し、適切にスキーマを更新します。

最新のスキーマは `db/schema.rb` に保存され、データベースの状態と一致するように管理されます。

---

## **2. マイグレーションの作成**
### **2.1 マイグレーションの記述例**

以下は `products` テーブルを作成するマイグレーションの例です。

```sh
$ bin/rails generate migration CreateProducts name:string description:text
```

生成されるマイグレーションファイル:

```ruby
# db/migrate/20240502100843_create_products.rb
class CreateProducts < ActiveRecord::Migration[8.0]
  def change
    create_table :products do |t|
      t.string :name
      t.text :description

      t.timestamps
    end
  end
end
```

このマイグレーションにより、`products` テーブルに以下のカラムが追加されます:
- `id`（デフォルトの主キー）
- `name`（`string` 型）
- `description`（`text` 型）
- `created_at`, `updated_at`（`timestamps` マクロにより自動追加）

---

## **3. スキーマの適用と管理**
マイグレーションを適用すると、`db/schema.rb` に最新のデータベース構造が記録されます。

```ruby
# db/schema.rb
ActiveRecord::Schema[8.0].define(version: 2024_05_02_100843) do
  create_table "products", force: :cascade do |t|
    t.string "name"
    t.text "description"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
  end
end
```

マイグレーションの実行により、データベースに新しいテーブルが作成され、スキーマファイルが更新されます。

---

## **4. マイグレーションのロールバック**
マイグレーションは**ロールバック**（取り消し）が可能で、適用前の状態に戻せます。

```sh
$ bin/rails db:rollback
```

これにより、直近のマイグレーションが元に戻され、テーブルが削除されるなどの適切な処理が行われます。

ロールバックを行うことで、変更を容易に取り消し、データベースの一貫性を保つことができます。

---

## **5. まとめ**
✅ **マイグレーション** を使用してデータベーススキーマを管理  
✅ **`rails generate migration`** コマンドでスキーマ変更を作成  
✅ **スキーマの適用とロールバック** で柔軟にデータベースを管理  
✅ **`db/schema.rb`** に最新のスキーマ情報が保存される


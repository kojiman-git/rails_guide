# 8 組み込みヘルスチェックエンドポイント

## 概要
Railsでは、アプリケーションの稼働状況を確認するために、組み込みのヘルスチェックエンドポイント `/up` が提供されています。これは、ロードバランサーや監視ツール、Kubernetesなどと連携してアプリの健全性を外部から確認するための仕組みです。

---

## 8.1 デフォルトの挙動

- 正常時：ステータスコード `200 OK`
- 異常時（例外発生時）：ステータスコード `500 Server Error`

```http
GET /up HTTP/1.1
```

この `/up` パスは、Rails 7.1 以降で生成される新規アプリケーションに自動的に含まれます。

---

## 8.2 カスタマイズ例

ルーティング設定で、別パスに変更可能です。

```ruby
# config/routes.rb
Rails.application.routes.draw do
  get "health" => "rails/health#show", as: :rails_health_check
end
```

これにより、以下のようにアクセス可能になります：

```http
GET /health
```

---

## 8.3 注意点と活用方法

- デフォルトの `/up` エンドポイントは、アプリの起動確認には使えますが、DB接続や外部APIの健全性まではカバーしません。
- より詳細なチェックが必要な場合は、`rails/health#show` を独自コントローラでオーバーライドしましょう。
- サードパーティが一時停止しているだけでアプリ全体を再起動しないよう、ヘルスチェックの内容は慎重に選定することが重要です。

---

## まとめ

| 内容               | 詳細                                                                 |
|--------------------|----------------------------------------------------------------------|
| デフォルトパス     | `/up`                                                                 |
| 成功時ステータス   | `200 OK`                                                             |
| 失敗時ステータス   | `500 Server Error`                                                   |
| パスの変更方法     | `routes.rb` で `rails/health#show` のルートを任意に変更可能             |
| 高度なチェック     | DBや外部サービスのステータス確認には、独自のコントローラを用意する必要あり |

アプリの運用や監視と連携する際には、このヘルスチェック機能を適切に活用しましょう。

